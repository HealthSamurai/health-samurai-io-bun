apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Deploy to default namespace (shared with dev)
namespace: default

resources:
  - ../../base

# Suffix creates: health-samurai-web-prod, postgres-prod, etc.
nameSuffix: "-prod"

labels:
  - pairs:
      environment: production
    includeSelectors: true

# 3 replicas for production
replicas:
  - name: health-samurai-web
    count: 3

configMapGenerator:
  - name: health-samurai-config
    behavior: replace
    literals:
      - GIT_REPO=https://github.com/HealthSamurai/health-samurai-io-bun.git
      - GIT_BRANCH=main
      - POLL_INTERVAL=120
      - PORT=4444

secretGenerator:
  - name: postgres-secret
    behavior: replace
    literals:
      - POSTGRES_USER=healthsamurai
      - POSTGRES_PASSWORD=healthsamurai
      - POSTGRES_DB=healthsamurai
      - DATABASE_URL=postgres://healthsamurai:healthsamurai@postgres-prod:5432/healthsamurai

images:
  - name: health-samurai-web
    newName: gcr.io/atomic-ehr/health-samurai-web
    newTag: latest
